<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gayathri Homa Registration - Shrimitra Networks</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      :root {
        --primary: #8b4513;
        --secondary: #d2691e;
        --accent: #ffd700;
        --light: #f5f5dc;
        --dark: #4b3621;
        --success: #4caf50;
        --warning: #ff9800;
        --error: #f44336;
        --admin: #2196f3;
      }

      body {
        background: linear-gradient(135deg, var(--light) 0%, #fff 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      /* Header Styles */
      .header {
        background: var(--primary);
        color: white;
        padding: 1.5rem 2rem;
        border-radius: 15px 15px 0 0;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
        position: relative;
      }

      .brand {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
      }

      .logo {
        font-size: 2rem;
        font-weight: bold;
        display: flex;
        align-items: center;
      }

      .logo-icon {
        margin-right: 15px;
        font-size: 2.5rem;
        color: var(--accent);
      }

      .copyright {
        font-size: 0.9rem;
        opacity: 0.9;
        text-align: right;
      }

      .brand-line {
        font-size: 1.1rem;
        margin-top: 10px;
        color: var(--accent);
        width: 100%;
        text-align: center;
        font-style: italic;
      }

      .admin-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: var(--admin);
        color: white;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        display: none;
      }

      /* Navigation */
      .nav-tabs {
        display: flex;
        background: white;
        border-radius: 10px 10px 0 0;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 0;
      }

      .nav-tab {
        flex: 1;
        padding: 1rem;
        text-align: center;
        background: #f8f9fa;
        border: none;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 600;
        color: var(--dark);
      }

      .nav-tab.active {
        background: var(--primary);
        color: white;
      }

      .nav-tab:hover:not(.active) {
        background: #e9ecef;
      }

      /* Main Content */
      .dashboard {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
      }

      @media (max-width: 968px) {
        .dashboard {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background: white;
        border-radius: 0 0 15px 15px;
        padding: 2rem;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        border-top: 5px solid var(--secondary);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .admin-card {
        border-top-color: var(--admin);
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
      }

      .card h2 {
        color: var(--primary);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        font-size: 1.5rem;
        border-bottom: 2px solid var(--light);
        padding-bottom: 0.5rem;
      }

      .admin-card h2 {
        color: var(--admin);
      }

      .card h2 i {
        margin-right: 12px;
        color: var(--secondary);
      }

      .admin-card h2 i {
        color: var(--admin);
      }

      /* Form Styles */
      .form-group {
        margin-bottom: 1.5rem;
      }

      label {
        display: block;
        margin-bottom: 0.5rem;
        color: var(--dark);
        font-weight: 600;
        font-size: 1rem;
      }

      .input-group {
        position: relative;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 0.85rem;
        border: 2px solid #e1e1e1;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s;
        background: #fafafa;
      }

      input:focus,
      select:focus,
      textarea:focus {
        border-color: var(--secondary);
        outline: none;
        background: white;
        box-shadow: 0 0 0 3px rgba(210, 105, 30, 0.1);
      }

      .admin-input:focus {
        border-color: var(--admin);
        box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
      }

      .btn {
        background: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--secondary) 100%
        );
        color: white;
        border: none;
        padding: 0.85rem 2rem;
        border-radius: 8px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .btn-admin {
        background: linear-gradient(135deg, var(--admin) 0%, #1976d2 100%);
      }

      .btn-success {
        background: linear-gradient(135deg, var(--success) 0%, #45a049 100%);
      }

      .btn-warning {
        background: linear-gradient(135deg, var(--warning) 0%, #e68a00 100%);
      }

      .btn-danger {
        background: linear-gradient(135deg, var(--error) 0%, #d32f2f 100%);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn:disabled {
        background: #cccccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .btn i {
        margin-right: 10px;
      }

      .btn-sm {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
      }

      /* Kunda Grid */
      .kunda-section {
        margin-top: 1.5rem;
      }

      .kunda-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
        gap: 12px;
        margin: 1.5rem 0;
        max-height: 400px;
        overflow-y: auto;
        padding: 10px;
        border: 2px solid #f0f0f0;
        border-radius: 10px;
        background: #fafafa;
      }

      .kunda {
        height: 65px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        border: 3px solid transparent;
        font-weight: bold;
        font-size: 1.1rem;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .kunda.available {
        background: #e8f5e9;
        color: #2e7d32;
        border-color: #c8e6c9;
      }

      .kunda.available:hover {
        background: #c8e6c9;
        transform: scale(1.05);
      }

      .kunda.booked {
        background: #ffebee;
        color: #c62828;
        border-color: #ffcdd2;
        cursor: not-allowed;
      }

      .kunda.selected {
        background: var(--accent);
        color: var(--dark);
        border-color: var(--secondary);
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
      }

      .kunda.own-booking {
        background: #e3f2fd;
        color: #1565c0;
        border-color: #90caf9;
      }

      /* Status Styles */
      .status-pending {
        color: var(--warning);
        font-weight: bold;
        background: #fff3e0;
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        display: inline-block;
      }

      .status-approved {
        color: var(--success);
        font-weight: bold;
        background: #e8f5e8;
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        display: inline-block;
      }

      .status-rejected {
        color: var(--error);
        font-weight: bold;
        background: #ffebee;
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        display: inline-block;
      }

      /* Booking Details */
      .booking-details {
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 2px dashed #e0e0e0;
        background: #fafafa;
        padding: 1.5rem;
        border-radius: 10px;
        display: none;
      }

      .booking-details.show {
        display: block;
        animation: fadeIn 0.5s ease;
      }

      .booking-details h3 {
        color: var(--primary);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
      }

      .booking-details h3 i {
        margin-right: 10px;
        color: var(--secondary);
      }

      .booking-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.8rem;
        padding: 0.8rem;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .booking-item:not(:last-child) {
        border-bottom: 1px dashed #e0e0e0;
      }

      .booking-item span:first-child {
        font-weight: 600;
        color: var(--dark);
      }

      .booking-item span:last-child {
        font-weight: 500;
      }

      /* Status Card */
      .status-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .admin-stats {
        background: linear-gradient(135deg, var(--admin) 0%, #1976d2 100%);
      }

      .status-card h2 {
        color: white;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        border: none;
      }

      .status-card h2 i {
        margin-right: 12px;
      }

      .status-content {
        background: rgba(255, 255, 255, 0.1);
        padding: 1.5rem;
        border-radius: 10px;
        backdrop-filter: blur(10px);
      }

      /* Notifications */
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1.2rem 1.8rem;
        background: white;
        border-radius: 10px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        border-left: 5px solid var(--success);
        transform: translateX(150%);
        transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        z-index: 1000;
        max-width: 400px;
      }

      .notification.error {
        border-left-color: var(--error);
      }

      .notification.warning {
        border-left-color: var(--warning);
      }

      .notification.show {
        transform: translateX(0);
      }

      .notification-content {
        display: flex;
        align-items: center;
      }

      .notification-icon {
        font-size: 1.5rem;
        margin-right: 15px;
      }

      .notification.success .notification-icon {
        color: var(--success);
      }

      .notification.error .notification-icon {
        color: var(--error);
      }

      .notification.warning .notification-icon {
        color: var(--warning);
      }

      /* Admin Tables */
      .data-table {
        width: 100%;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 1rem;
      }

      .data-table table {
        width: 100%;
        border-collapse: collapse;
      }

      .data-table th,
      .data-table td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
      }

      .data-table th {
        background: #f8f9fa;
        font-weight: 600;
        color: var(--dark);
      }

      .data-table tr:hover {
        background: #f5f5f5;
      }

      .action-buttons {
        display: flex;
        gap: 0.5rem;
      }

      /* Footer */
      .footer {
        text-align: center;
        padding: 2rem;
        margin-top: 3rem;
        background: var(--dark);
        color: white;
        border-radius: 0 0 15px 15px;
      }

      .footer p {
        margin-bottom: 0.5rem;
      }

      .powered-by {
        font-size: 0.9rem;
        opacity: 0.8;
        margin-top: 1rem;
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      /* Loading Spinner */
      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid var(--secondary);
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
        display: inline-block;
        margin-right: 10px;
      }

      .admin-spinner {
        border-top-color: var(--admin);
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Stats Section */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.2);
        padding: 1.5rem;
        border-radius: 10px;
        text-align: center;
        backdrop-filter: blur(10px);
      }

      .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        display: block;
      }

      .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
      }

      /* Login Form */
      .login-form {
        max-width: 400px;
        margin: 2rem auto;
        padding: 2rem;
        background: white;
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      }

      .login-form h2 {
        text-align: center;
        margin-bottom: 2rem;
        color: var(--admin);
      }

      /* Tab Content */
      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.5s ease;
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        .header {
          padding: 1rem;
        }

        .logo {
          font-size: 1.5rem;
        }

        .brand {
          flex-direction: column;
          text-align: center;
        }

        .copyright {
          text-align: center;
          margin-top: 10px;
        }

        .card {
          padding: 1.5rem;
        }

        .kunda-grid {
          grid-template-columns: repeat(auto-fill, minmax(55px, 1fr));
        }

        .kunda {
          height: 55px;
          font-size: 1rem;
        }

        .notification {
          right: 10px;
          left: 10px;
          max-width: none;
        }

        .stats-grid {
          grid-template-columns: 1fr 1fr;
        }

        .data-table {
          overflow-x: auto;
        }

        .nav-tabs {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <div class="brand">
          <div class="logo">
            <i class="fas fa-fire-alt logo-icon"></i>
            Gayathri Homa Registration
          </div>
          <div class="copyright">
            &copy; Shrimitra Networks. All Rights Reserved.
          </div>
          <div class="brand-line">
            Build by D.A Chaithanya Vishwamitra & Shrimitra Networks
          </div>
        </div>
        <div class="admin-badge" id="adminBadge">
          <i class="fas fa-user-shield"></i> Admin Mode
        </div>
      </div>

      <!-- Navigation Tabs -->
      <div class="nav-tabs" id="navTabs" style="display: none">
        <button class="nav-tab active" data-tab="user">User Portal</button>
        <button class="nav-tab" data-tab="admin">Admin Panel</button>
      </div>

      <!-- User Portal -->
      <div id="userPortal" class="tab-content active">
        <!-- Stats Section -->
        <div class="status-card">
          <h2><i class="fas fa-chart-bar"></i> Live Statistics</h2>
          <div class="status-content">
            <div class="stats-grid" id="statsGrid">
              <div class="stat-card">
                <span class="stat-number" id="totalUsers">0</span>
                <span class="stat-label">Total Registrations</span>
              </div>
              <div class="stat-card">
                <span class="stat-number" id="totalBookings">0</span>
                <span class="stat-label">Total Bookings</span>
              </div>
              <div class="stat-card">
                <span class="stat-number" id="availableKundas">100</span>
                <span class="stat-label">Available Kundas</span>
              </div>
              <div class="stat-card">
                <span class="stat-number" id="approvedBookings">0</span>
                <span class="stat-label">Approved Bookings</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Main Dashboard -->
        <div class="dashboard">
          <!-- Registration Card -->
          <div class="card">
            <h2><i class="fas fa-user-plus"></i> User Registration</h2>
            <form id="registrationForm">
              <div class="form-group">
                <label for="name"><i class="fas fa-user"></i> Full Name</label>
                <input
                  type="text"
                  id="name"
                  required
                  placeholder="Enter your full name"
                />
              </div>
              <div class="form-group">
                <label for="phone"
                  ><i class="fas fa-phone"></i> Phone Number</label
                >
                <input
                  type="tel"
                  id="phone"
                  required
                  placeholder="Enter your 10-digit phone number"
                  pattern="[0-9]{10}"
                  maxlength="10"
                />
                <small
                  style="
                    color: #666;
                    font-size: 0.8rem;
                    margin-top: 5px;
                    display: block;
                  "
                  >We'll check if you're already registered</small
                >
              </div>
              <div class="form-group">
                <label for="email"
                  ><i class="fas fa-envelope"></i> Email Address</label
                >
                <input
                  type="email"
                  id="email"
                  required
                  placeholder="Enter your email address"
                />
              </div>
              <div class="form-group">
                <label for="members"
                  ><i class="fas fa-users"></i> Number of Members
                  Attending</label
                >
                <select id="members" required>
                  <option value="">Select number of members</option>
                  <option value="1">1 Member</option>
                  <option value="2">2 Members</option>
                  <option value="3">3 Members</option>
                  <option value="4">4 Members</option>
                  <option value="5">5 Members</option>
                  <option value="6">6+ Members (Contact Admin)</option>
                </select>
              </div>
              <button type="submit" class="btn" id="registerBtn">
                <i class="fas fa-user-check"></i> Complete Registration
              </button>
            </form>
          </div>

          <!-- Kunda Booking Card -->
          <div class="card">
            <h2><i class="fas fa-fire"></i> Book Homa Kunda</h2>
            <div id="bookingSection">
              <div class="form-group">
                <label
                  ><i class="fas fa-tasks"></i> Select Available Kunda
                  (1-100)</label
                >
                <div class="kunda-section">
                  <div class="kunda-grid" id="kundaGrid">
                    <!-- Kunda buttons will be generated by JavaScript -->
                  </div>
                </div>
              </div>
              <div class="form-group">
                <button id="bookKunda" class="btn" disabled>
                  <i class="fas fa-bookmark"></i> Book Selected Kunda
                </button>
              </div>

              <div class="booking-details" id="bookingDetails">
                <h3><i class="fas fa-receipt"></i> Your Booking Details</h3>
                <div class="booking-item">
                  <span>Kunda Number:</span>
                  <span id="bookedKunda">-</span>
                </div>
                <div class="booking-item">
                  <span>Status:</span>
                  <span id="bookingStatus" class="status-pending"
                    >Pending Approval</span
                  >
                </div>
                <div class="booking-item">
                  <span>Registration ID:</span>
                  <span id="registrationId">-</span>
                </div>
                <div class="booking-item">
                  <span>Booking ID:</span>
                  <span id="bookingId">-</span>
                </div>
                <div class="booking-item">
                  <span>Booking Date:</span>
                  <span id="bookingDate">-</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Status Card -->
        <div class="status-card">
          <h2><i class="fas fa-history"></i> Booking Status</h2>
          <div class="status-content" id="statusMessage">
            <p>
              Complete registration and kunda booking to see your status here.
            </p>
          </div>
        </div>

        <!-- Admin Login Button -->
        <div class="card" style="text-align: center">
          <h2><i class="fas fa-user-shield"></i> Admin Access</h2>
          <p>
            Are you an administrator? Click below to access the admin panel.
          </p>
          <button class="btn btn-admin" onclick="showAdminLogin()">
            <i class="fas fa-sign-in-alt"></i> Admin Login
          </button>
        </div>
      </div>

      <!-- Admin Portal -->
      <div id="adminPortal" class="tab-content">
        <!-- Admin Login Form -->
        <div id="adminLoginForm" class="login-form">
          <h2><i class="fas fa-user-shield"></i> Admin Login</h2>
          <div class="form-group">
            <label for="adminUsername"
              ><i class="fas fa-user"></i> Username</label
            >
            <input
              type="text"
              id="adminUsername"
              class="admin-input"
              placeholder="Enter any username"
            />
            <small
              style="
                color: #666;
                font-size: 0.8rem;
                margin-top: 5px;
                display: block;
              "
              >Any username works with correct password</small
            >
          </div>
          <div class="form-group">
            <label for="adminPassword"
              ><i class="fas fa-lock"></i> Password</label
            >
            <input
              type="password"
              id="adminPassword"
              class="admin-input"
              placeholder="Enter admin password"
            />
          </div>
          <button
            class="btn btn-admin"
            onclick="adminLogin()"
            id="adminLoginBtn"
          >
            <i class="fas fa-sign-in-alt"></i> Login
          </button>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" style="display: none">
          <!-- Admin Stats -->
          <div class="status-card admin-stats">
            <h2><i class="fas fa-chart-bar"></i> Admin Dashboard</h2>
            <div class="status-content">
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 1rem;
                "
              >
                <span>Welcome, <strong id="adminWelcome">Admin</strong>!</span>
                <button class="btn btn-danger btn-sm" onclick="adminLogout()">
                  <i class="fas fa-sign-out-alt"></i> Logout
                </button>
              </div>
              <div class="stats-grid">
                <div class="stat-card">
                  <span class="stat-number" id="adminTotalUsers">0</span>
                  <span class="stat-label">Total Users</span>
                </div>
                <div class="stat-card">
                  <span class="stat-number" id="adminTotalBookings">0</span>
                  <span class="stat-label">Total Bookings</span>
                </div>
                <div class="stat-card">
                  <span class="stat-number" id="adminAvailableKundas">100</span>
                  <span class="stat-label">Available Kundas</span>
                </div>
                <div class="stat-card">
                  <span class="stat-number" id="adminPendingBookings">0</span>
                  <span class="stat-label">Pending Approval</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Pending Bookings -->
          <div class="card admin-card">
            <h2><i class="fas fa-clock"></i> Pending Bookings</h2>
            <div id="pendingBookings">
              <p>Loading pending bookings...</p>
            </div>
          </div>

          <!-- All Bookings -->
          <div class="card admin-card">
            <h2><i class="fas fa-list"></i> All Bookings</h2>
            <div id="allBookings">
              <p>Loading all bookings...</p>
            </div>
          </div>

          <!-- All Users -->
          <div class="card admin-card">
            <h2><i class="fas fa-users"></i> All Registered Users</h2>
            <div id="allUsers">
              <p>Loading users...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="footer">
        <p><strong>Gayathri Homa Registration System</strong></p>
        <p>Secure • Reliable • Efficient</p>
        <div class="powered-by">
          Powered by Shrimitra Networks | Build by D.A Chaithanya Vishwamitra
        </div>
      </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
      <div class="notification-content">
        <div class="notification-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <div id="notificationMessage">Notification message</div>
      </div>
    </div>

    <script>
      // Application State
      const state = {
        user: null,
        selectedKunda: null,
        userBooking: null,
        kundas: [],
        admin: {
          loggedIn: false,
          username: null,
        },
      };

      // DOM Elements
      const elements = {
        // User elements
        registrationForm: document.getElementById("registrationForm"),
        kundaGrid: document.getElementById("kundaGrid"),
        bookKunda: document.getElementById("bookKunda"),
        bookingDetails: document.getElementById("bookingDetails"),
        bookedKunda: document.getElementById("bookedKunda"),
        bookingStatus: document.getElementById("bookingStatus"),
        registrationId: document.getElementById("registrationId"),
        bookingId: document.getElementById("bookingId"),
        bookingDate: document.getElementById("bookingDate"),
        statusMessage: document.getElementById("statusMessage"),
        notification: document.getElementById("notification"),
        notificationMessage: document.getElementById("notificationMessage"),
        registerBtn: document.getElementById("registerBtn"),

        // Stats elements
        totalUsers: document.getElementById("totalUsers"),
        totalBookings: document.getElementById("totalBookings"),
        availableKundas: document.getElementById("availableKundas"),
        approvedBookings: document.getElementById("approvedBookings"),

        // Admin elements
        adminBadge: document.getElementById("adminBadge"),
        navTabs: document.getElementById("navTabs"),
        userPortal: document.getElementById("userPortal"),
        adminPortal: document.getElementById("adminPortal"),
        adminLoginForm: document.getElementById("adminLoginForm"),
        adminDashboard: document.getElementById("adminDashboard"),
        adminWelcome: document.getElementById("adminWelcome"),
        adminTotalUsers: document.getElementById("adminTotalUsers"),
        adminTotalBookings: document.getElementById("adminTotalBookings"),
        adminAvailableKundas: document.getElementById("adminAvailableKundas"),
        adminPendingBookings: document.getElementById("adminPendingBookings"),
        pendingBookings: document.getElementById("pendingBookings"),
        allBookings: document.getElementById("allBookings"),
        allUsers: document.getElementById("allUsers"),
      };

      // Initialize the application
      async function initApp() {
        await loadStats();
        await loadKundas();
        setupEventListeners();

        // Check for existing user in localStorage
        const savedUser = localStorage.getItem("homaUser");
        if (savedUser) {
          state.user = JSON.parse(savedUser);
          await checkUserBooking(state.user.phone);
          updateStatusMessage();
        }

        // Check if admin is logged in
        checkAdminStatus();
      }

      // Check admin login status
      async function checkAdminStatus() {
        // For now, we'll rely on session storage
        // In a real app, you'd verify with the server
      }

      // Load statistics
      async function loadStats() {
        try {
          const response = await fetch("/api/stats");
          const data = await response.json();

          if (data.success) {
            elements.totalUsers.textContent = data.stats.total_users;
            elements.totalBookings.textContent = data.stats.total_bookings;
            elements.availableKundas.textContent = data.stats.available_kundas;
            elements.approvedBookings.textContent =
              data.stats.approved_bookings;
          }
        } catch (error) {
          console.error("Failed to load stats:", error);
        }
      }

      // Load admin statistics
      async function loadAdminStats() {
        try {
          const response = await fetch("/api/admin/stats");
          const data = await response.json();

          if (data.success) {
            elements.adminTotalUsers.textContent = data.stats.total_users;
            elements.adminTotalBookings.textContent = data.stats.total_bookings;
            elements.adminAvailableKundas.textContent =
              data.stats.available_kundas;
            elements.adminPendingBookings.textContent =
              data.stats.pending_bookings;
          }
        } catch (error) {
          console.error("Failed to load admin stats:", error);
        }
      }

      // Load kundas from backend
      async function loadKundas() {
        try {
          const response = await fetch("/api/kundas");
          const data = await response.json();

          if (data.success) {
            state.kundas = data.kundas;
            generateKundaGrid();
          }
        } catch (error) {
          console.error("Failed to load kundas:", error);
          showNotification(
            "Failed to load kundas. Please refresh the page.",
            "error"
          );
        }
      }

      // Generate kunda grid
      function generateKundaGrid() {
        elements.kundaGrid.innerHTML = "";

        state.kundas.forEach((kunda) => {
          const kundaEl = document.createElement("div");
          kundaEl.className = `kunda ${kunda.status}`;
          kundaEl.textContent = kunda.kunda_number;
          kundaEl.dataset.id = kunda.kunda_number;

          if (kunda.status === "booked") {
            kundaEl.title = kunda.booked_by_name
              ? `Booked by ${kunda.booked_by_name}`
              : "Booked";
            kundaEl.style.cursor = "not-allowed";
          } else {
            kundaEl.addEventListener("click", () =>
              selectKunda(kunda.kunda_number)
            );
          }

          // Highlight user's own booking
          if (
            state.userBooking &&
            state.userBooking.kunda_number === kunda.kunda_number
          ) {
            kundaEl.className = "kunda own-booking";
            kundaEl.title = "Your Booking";
          }

          elements.kundaGrid.appendChild(kundaEl);
        });
      }

      // Select a kunda
      function selectKunda(kundaNumber) {
        if (state.userBooking) {
          showNotification(
            "You already have a booking. Cannot book multiple kundas.",
            "error"
          );
          return;
        }

        state.selectedKunda = kundaNumber;

        // Update UI
        document.querySelectorAll(".kunda").forEach((k) => {
          k.classList.remove("selected");
        });

        const selectedEl = document.querySelector(
          `.kunda[data-id="${kundaNumber}"]`
        );
        if (selectedEl) {
          selectedEl.classList.add("selected");
          elements.bookKunda.disabled = false;
        }
      }

      // Show notification
      function showNotification(message, type = "success") {
        const notification = elements.notification;
        const messageEl = elements.notificationMessage;
        const icon = notification.querySelector(".notification-icon i");

        messageEl.textContent = message;

        // Set type and icon
        notification.className = `notification ${type}`;
        if (type === "success") {
          icon.className = "fas fa-check-circle";
        } else if (type === "error") {
          icon.className = "fas fa-exclamation-circle";
        } else if (type === "warning") {
          icon.className = "fas fa-exclamation-triangle";
        }

        notification.classList.add("show");

        setTimeout(() => {
          notification.classList.remove("show");
        }, 5000);
      }

      // Check if user is already registered
      async function checkPhoneRegistration(phone) {
        try {
          const response = await fetch(`/api/check-phone/${phone}`);
          const data = await response.json();

          if (data.success && data.exists) {
            state.user = data.user;
            localStorage.setItem("homaUser", JSON.stringify(data.user));
            await checkUserBooking(phone);
            updateStatusMessage();
            showNotification(
              "Welcome back! Your details are loaded.",
              "success"
            );
            return true;
          }
          return false;
        } catch (error) {
          console.error("Phone check error:", error);
          return false;
        }
      }

      // Check user's existing booking
      async function checkUserBooking(phone) {
        try {
          const response = await fetch(`/api/user/bookings/${phone}`);
          const data = await response.json();

          if (data.success && data.bookings.length > 0) {
            state.userBooking = data.bookings[0];
            updateUIWithBooking(state.userBooking);
            showNotification("Your existing booking is loaded.", "success");
          }
        } catch (error) {
          console.error("Booking check error:", error);
        }
      }

      // Handle registration form submission
      async function handleRegistration(e) {
        e.preventDefault();

        const name = document.getElementById("name").value.trim();
        const phone = document.getElementById("phone").value.trim();
        const email = document.getElementById("email").value.trim();
        const members = document.getElementById("members").value;

        // Validation
        if (!name || !phone || !email || !members) {
          showNotification("Please fill all fields", "error");
          return;
        }

        if (!/^\d{10}$/.test(phone)) {
          showNotification(
            "Please enter a valid 10-digit phone number",
            "error"
          );
          return;
        }

        // Show loading state
        const originalText = elements.registerBtn.innerHTML;
        elements.registerBtn.innerHTML =
          '<div class="spinner"></div> Processing...';
        elements.registerBtn.disabled = true;

        try {
          const response = await fetch("/api/register", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              name: name,
              phone: phone,
              email: email,
              members: parseInt(members),
            }),
          });

          const data = await response.json();

          if (data.success) {
            state.user = data.user;
            localStorage.setItem("homaUser", JSON.stringify(data.user));
            showNotification(data.message, "success");
            updateStatusMessage();
            await loadStats();
            await loadKundas();
          } else {
            showNotification(data.error, "error");
          }
        } catch (error) {
          showNotification("Network error. Please try again.", "error");
        } finally {
          elements.registerBtn.innerHTML = originalText;
          elements.registerBtn.disabled = false;
        }
      }

      // Handle kunda booking
      async function handleKundaBooking() {
        if (!state.user) {
          showNotification("Please complete registration first", "error");
          return;
        }

        if (!state.selectedKunda) {
          showNotification("Please select a kunda", "error");
          return;
        }

        // Show loading state
        const originalText = elements.bookKunda.innerHTML;
        elements.bookKunda.innerHTML = '<div class="spinner"></div> Booking...';
        elements.bookKunda.disabled = true;

        try {
          const response = await fetch("/api/bookings", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              user_id: state.user.id,
              kunda_number: state.selectedKunda,
            }),
          });

          const data = await response.json();

          if (data.success) {
            state.userBooking = data.booking;
            showNotification(data.message, "success");
            updateUIWithBooking(data.booking);
            await loadStats();
            await loadKundas();
          } else {
            showNotification(data.error, "error");
          }
        } catch (error) {
          showNotification("Network error. Please try again.", "error");
        } finally {
          elements.bookKunda.innerHTML = originalText;
          elements.bookKunda.disabled = true;
        }
      }

      // Update UI with booking details
      function updateUIWithBooking(booking) {
        elements.bookedKunda.textContent = booking.kunda_number;
        elements.registrationId.textContent = booking.registration_id;
        elements.bookingId.textContent = booking.booking_id;
        elements.bookingDate.textContent = new Date(
          booking.booked_at
        ).toLocaleString();

        // Update status
        elements.bookingStatus.textContent =
          booking.status.charAt(0).toUpperCase() + booking.status.slice(1);
        elements.bookingStatus.className = `status-${booking.status}`;

        // Show booking details
        elements.bookingDetails.classList.add("show");

        // Update status message
        updateStatusMessage();
      }

      // Update status message
      function updateStatusMessage() {
        if (state.userBooking) {
          const statusClass = `status-${state.userBooking.status}`;
          elements.statusMessage.innerHTML = `
                    <div style="display: grid; gap: 15px;">
                        <div style="display: flex; justify-content: space-between; background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                            <span>Registration ID:</span>
                            <strong>${
                              state.userBooking.registration_id
                            }</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                            <span>Kunda Number:</span>
                            <strong>${state.userBooking.kunda_number}</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                            <span>Status:</span>
                            <span class="${statusClass}">${
            state.userBooking.status.charAt(0).toUpperCase() +
            state.userBooking.status.slice(1)
          }</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
                            <span>Members:</span>
                            <strong>${state.userBooking.members_count}</strong>
                        </div>
                    </div>
                `;
        } else if (state.user) {
          elements.statusMessage.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <h3 style="margin-bottom: 15px;">Registration Complete!</h3>
                        <p>Welcome <strong>${state.user.name}</strong>!</p>
                        <p>Your Registration ID: <strong>${state.user.registration_id}</strong></p>
                        <p style="margin-top: 15px;">Please select a kunda to complete your booking.</p>
                    </div>
                `;
        } else {
          elements.statusMessage.innerHTML = `
                    <p>Complete registration and kunda booking to see your status here.</p>
                `;
        }
      }

      // Admin Functions
      function showAdminLogin() {
        switchTab("admin");
      }

      async function adminLogin() {
        const username = document.getElementById("adminUsername").value.trim();
        const password = document.getElementById("adminPassword").value.trim();

        if (!username || !password) {
          showNotification("Please enter both username and password", "error");
          return;
        }

        const loginBtn = document.getElementById("adminLoginBtn");
        const originalText = loginBtn.innerHTML;
        loginBtn.innerHTML =
          '<div class="spinner admin-spinner"></div> Logging in...';
        loginBtn.disabled = true;

        try {
          const response = await fetch("/api/admin/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              username: username,
              password: password,
            }),
          });

          const data = await response.json();

          if (data.success) {
            state.admin.loggedIn = true;
            state.admin.username = data.username;

            elements.adminBadge.style.display = "block";
            elements.navTabs.style.display = "flex";
            elements.adminLoginForm.style.display = "none";
            elements.adminDashboard.style.display = "block";
            elements.adminWelcome.textContent = data.username;

            await loadAdminStats();
            await loadAdminData();

            showNotification("Admin login successful!", "success");
          } else {
            showNotification(data.error, "error");
          }
        } catch (error) {
          showNotification("Network error. Please try again.", "error");
        } finally {
          loginBtn.innerHTML = originalText;
          loginBtn.disabled = false;
        }
      }

      async function adminLogout() {
        try {
          const response = await fetch("/api/admin/logout", {
            method: "POST",
          });

          state.admin.loggedIn = false;
          state.admin.username = null;

          elements.adminBadge.style.display = "none";
          elements.adminLoginForm.style.display = "block";
          elements.adminDashboard.style.display = "none";

          switchTab("user");

          showNotification("Admin logout successful!", "success");
        } catch (error) {
          console.error("Logout error:", error);
        }
      }

      async function loadAdminData() {
        await loadPendingBookings();
        await loadAllBookings();
        await loadAllUsers();
      }

      async function loadPendingBookings() {
        try {
          const response = await fetch("/api/admin/bookings");
          const data = await response.json();

          if (data.success) {
            const pending = data.bookings.filter((b) => b.status === "pending");

            if (pending.length === 0) {
              elements.pendingBookings.innerHTML =
                "<p>No pending bookings at the moment.</p>";
              return;
            }

            let html = `
                        <div class="data-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Booking ID</th>
                                        <th>User</th>
                                        <th>Phone</th>
                                        <th>Kunda</th>
                                        <th>Members</th>
                                        <th>Booked At</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;

            pending.forEach((booking) => {
              html += `
                            <tr>
                                <td>${booking.booking_id}</td>
                                <td>${booking.name}</td>
                                <td>${booking.phone}</td>
                                <td>${booking.kunda_number}</td>
                                <td>${booking.members_count}</td>
                                <td>${new Date(
                                  booking.booked_at
                                ).toLocaleString()}</td>
                                <td class="action-buttons">
                                    <button class="btn btn-success btn-sm" onclick="approveBooking('${
                                      booking.booking_id
                                    }')">
                                        <i class="fas fa-check"></i> Approve
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="rejectBooking('${
                                      booking.booking_id
                                    }')">
                                        <i class="fas fa-times"></i> Reject
                                    </button>
                                </td>
                            </tr>
                        `;
            });

            html += `</tbody></table></div>`;
            elements.pendingBookings.innerHTML = html;
          }
        } catch (error) {
          console.error("Failed to load pending bookings:", error);
          elements.pendingBookings.innerHTML =
            "<p>Error loading pending bookings.</p>";
        }
      }

      async function loadAllBookings() {
        try {
          const response = await fetch("/api/admin/bookings");
          const data = await response.json();

          if (data.success) {
            if (data.bookings.length === 0) {
              elements.allBookings.innerHTML = "<p>No bookings found.</p>";
              return;
            }

            let html = `
                        <div class="data-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Booking ID</th>
                                        <th>User</th>
                                        <th>Phone</th>
                                        <th>Kunda</th>
                                        <th>Status</th>
                                        <th>Members</th>
                                        <th>Booked At</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;

            data.bookings.forEach((booking) => {
              const statusClass = `status-${booking.status}`;
              html += `
                            <tr>
                                <td>${booking.booking_id}</td>
                                <td>${booking.name}</td>
                                <td>${booking.phone}</td>
                                <td>${booking.kunda_number}</td>
                                <td><span class="${statusClass}">${
                booking.status.charAt(0).toUpperCase() + booking.status.slice(1)
              }</span></td>
                                <td>${booking.members_count}</td>
                                <td>${new Date(
                                  booking.booked_at
                                ).toLocaleString()}</td>
                            </tr>
                        `;
            });

            html += `</tbody></table></div>`;
            elements.allBookings.innerHTML = html;
          }
        } catch (error) {
          console.error("Failed to load all bookings:", error);
          elements.allBookings.innerHTML = "<p>Error loading bookings.</p>";
        }
      }

      async function loadAllUsers() {
        try {
          const response = await fetch("/api/admin/users");
          const data = await response.json();

          if (data.success) {
            if (data.users.length === 0) {
              elements.allUsers.innerHTML = "<p>No users registered yet.</p>";
              return;
            }

            let html = `
                        <div class="data-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Reg ID</th>
                                        <th>Name</th>
                                        <th>Phone</th>
                                        <th>Email</th>
                                        <th>Members</th>
                                        <th>Booking Status</th>
                                        <th>Kunda</th>
                                        <th>Registered At</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;

            data.users.forEach((user) => {
              const bookingStatus = user.booking_status
                ? `<span class="status-${user.booking_status}">${
                    user.booking_status.charAt(0).toUpperCase() +
                    user.booking_status.slice(1)
                  }</span>`
                : "No Booking";
              const kundaNumber = user.kunda_number || "-";

              html += `
                            <tr>
                                <td>${user.registration_id}</td>
                                <td>${user.name}</td>
                                <td>${user.phone}</td>
                                <td>${user.email}</td>
                                <td>${user.members_count}</td>
                                <td>${bookingStatus}</td>
                                <td>${kundaNumber}</td>
                                <td>${new Date(
                                  user.created_at
                                ).toLocaleString()}</td>
                            </tr>
                        `;
            });

            html += `</tbody></table></div>`;
            elements.allUsers.innerHTML = html;
          }
        } catch (error) {
          console.error("Failed to load users:", error);
          elements.allUsers.innerHTML = "<p>Error loading users.</p>";
        }
      }

      async function approveBooking(bookingId) {
        try {
          const response = await fetch(`/api/admin/bookings/approve`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              booking_id: bookingId,
            }),
          });

          const data = await response.json();

          if (data.success) {
            showNotification(data.message, "success");
            await loadAdminStats();
            await loadAdminData();
          } else {
            showNotification(data.error, "error");
          }
        } catch (error) {
          showNotification("Network error. Please try again.", "error");
        }
      }

      async function rejectBooking(bookingId) {
        if (
          !confirm(
            "Are you sure you want to reject this booking? The kunda will become available again."
          )
        ) {
          return;
        }

        try {
          const response = await fetch(`/api/admin/bookings/reject`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              booking_id: bookingId,
            }),
          });

          const data = await response.json();

          if (data.success) {
            showNotification(data.message, "success");
            await loadAdminStats();
            await loadAdminData();
          } else {
            showNotification(data.error, "error");
          }
        } catch (error) {
          showNotification("Network error. Please try again.", "error");
        }
      }

      // Tab switching
      function switchTab(tabName) {
        // Update tabs
        document.querySelectorAll(".nav-tab").forEach((tab) => {
          tab.classList.remove("active");
        });
        document
          .querySelector(`.nav-tab[data-tab="${tabName}"]`)
          .classList.add("active");

        // Update content
        document.querySelectorAll(".tab-content").forEach((content) => {
          content.classList.remove("active");
        });
        document.getElementById(`${tabName}Portal`).classList.add("active");
      }

      // Setup event listeners
      function setupEventListeners() {
        elements.registrationForm.addEventListener(
          "submit",
          handleRegistration
        );
        elements.bookKunda.addEventListener("click", handleKundaBooking);

        // Tab switching
        document.querySelectorAll(".nav-tab").forEach((tab) => {
          tab.addEventListener("click", function () {
            switchTab(this.dataset.tab);
          });
        });

        // Real-time phone validation and check
        document
          .getElementById("phone")
          .addEventListener("blur", async function (e) {
            const phone = this.value.trim();
            if (phone.length === 10 && /^\d+$/.test(phone)) {
              const isRegistered = await checkPhoneRegistration(phone);
              if (isRegistered) {
                document.getElementById("name").value = state.user.name;
                document.getElementById("email").value = state.user.email;
                document.getElementById("members").value =
                  state.user.members_count;
                showNotification(
                  "Your previous registration details are loaded.",
                  "success"
                );
              }
            }
          });

        // Prevent non-numeric input in phone field
        document
          .getElementById("phone")
          .addEventListener("input", function (e) {
            this.value = this.value.replace(/\D/g, "").slice(0, 10);
          });

        // Admin password enter key
        document
          .getElementById("adminPassword")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              adminLogin();
            }
          });
      }

      // Initialize when DOM is loaded
      document.addEventListener("DOMContentLoaded", initApp);
    </script>
  </body>
</html>
